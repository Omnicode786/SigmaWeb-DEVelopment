
<section class="thread-page card text-light">
  <h2><%= thread.title %></h2>
  <p><%= thread.content %></p>
  <small>by <%= thread.author ? thread.author.username : 'Unknown' %></small>

  <hr />
  <h3>Comments</h3>

  <div id="comments">
    <% comments.forEach(comment => { %>
      <div class="comment" data-id="<%= comment._id %>">
        <div class="comment-body">
          <strong><%= comment.author ? comment.author.username : 'Unknown' %></strong>
          <p><%= comment.content %></p>
          <div class="meta">
            <button class="upvote-comment" data-id="<%= comment._id %>">▲</button>
            <span class="upvote-count"><%= comment.upvotes %></span>
            <button class="show-reply-form" data-id="<%= comment._id %>">Reply</button>
          </div>
        </div>

        <div class="replies"> 
          <% comment.replies.forEach(reply => { %>
            <div class="reply" data-id="<%= reply._id %>">
              <strong><%= reply.author ? reply.author.username : 'Unknown' %>
                <% if (reply.author && reply.author.role === 'admin') { %>
                  <span class="admin-badge">ADMIN</span>
                <% } %>
              </strong>
              <p><%= reply.content %></p>
              <div class="meta">
                <button class="upvote-reply" data-id="<%= reply._id %>">▲</button>
                <span class="upvote-count"><%= reply.upvotes %></span>
              </div>
            </div>
          <% }) %>
        </div>

        <div class="reply-form" id="reply-form-<%= comment._id %>" style="display:none;">
          <textarea class="reply-content"></textarea>
          <button class="submit-reply" data-id="<%= comment._id %>">Submit Reply</button>
        </div>
      </div>
    <% }) %>
  </div>

  <hr />
  <div>
    <h4>Add a Comment</h4>
    <textarea id="new-comment-content"></textarea>
    <button id="submit-comment" data-thread-id="<%= thread._id %>">Post Comment</button>
  </div>

</section>
